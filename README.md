# Telegram Folder Manager

Автоматизация управления папками (folders) Telegram. Скрипт позволяет автоматически сортировать чаты и каналы по папкам, основываясь на шаблонах и исключениях.

---

## Возможности

- Автоматическая сортировка чатов по папкам по заданным паттернам
- Поддержка исключающих шаблонов для исключений из папок
- Определение **основной** папки для каждого чата — один чат находится только в одной папке
- Обновление и создание папок динамически
- Стратегии обработки несопоставленных чатов (игнор, перемещение, логирование и др.)
- Поддержка работы как самостоятельного скрипта и как Python-модуля

---

## Требования

- Python 3.12+
- Аккаунт Telegram
- Полученные **API ID** и **API Hash**

---

## Установка

1. **Клонировать репозиторий:**

```

git clone https://github.com/sky1su/tg_folder_manager.git
cd tg_folder_manager

```

2. **Установить зависимости:**

```

pip install telethon python-dotenv PyYAML

```

Или с `requirements.txt`:

```

pip install -r requirements.txt

```

3. **Создать файл `.env` в корне проекта:**

```

app_api_id=ВАШ_API_ID
app_api_hash=ВАШ_API_HASH
app_title=telegram_session

```

---

## Регистрация клиента Telegram (получение API ID и API Hash)

Для работы скрипта требуется зарегистрировать собственное приложение Telegram.

1. Откройте браузер и перейдите по ссылке  
[https://my.telegram.org](https://my.telegram.org)

2. Войдите с помощью своего номера телефона  

- Введите номер телефона  
- Подтвердите вход кодом из Telegram

3. Перейдите в раздел **API Development Tools**

4. Создайте новое приложение:

- **App title:** любое имя, например `TG Folder Manager`
- **Short name:** короткое уникальное имя, например `tgfolder`
- Остальные поля можно заполнить произвольно или оставить пустыми

5. После создания скопируйте выданные значения:

- **API ID**
- **API Hash**

6. Добавьте их в файл `.env` вашего проекта (см. пример выше).

> ⚠️ Эти ключи дают полный доступ к вашему аккаунту Telegram API. Никогда не передавайте их и не сохраняйте в публичных репозиториях.

---

## Конфигурирование

Файл `config.yaml` должен находиться в корне проекта:

```yaml

folders:
  Работа:
    include_patterns:
        - work
        - проект
        - работа
    exclude_patterns:
        - тест
        - demo

    Крипто:
        include_patterns:
            - bitcoin
            - ethereum
            - крипто
        exclude_patterns:
            - testnet
            - тест
        
    Dev:
        include_patterns:
            - python
            - django
            - fastapi
        exclude_patterns:
            - старое
            - архив

```

### Пояснение

- `include_patterns`: регулярные выражения или ключевые слова для добавления чата в папку.
- `exclude_patterns`: шаблоны, исключающие чат, даже если он подходит под `include_patterns`.

---

## Использование

### Вариант запуск модуля

Структура проекта:

```bash

tg_folder_manager/
├── tg_folder_manage/
│   ├── __init__.py
│   ├── __main__.py
│   └── tg_folder_manager.py
├── config.yaml
└── .env

```

Выполните:

```bash

python3 -m tg_folder_manage

```

---

## Первый запуск

При первом запуске Telethon запросит авторизацию:

1. Номер телефона
2. Код подтверждения из Telegram
3. Двухфакторный пароль (если включен)

После этого создаётся файл сессии (например, `telegram_session.session`), и повторный ввод данных не потребуется.

---

## Поведение при несопоставленных чатах

Можно задать стратегию обработки:

```

UnmatchedChatsStrategy.IGNORE             \# игнорировать
UnmatchedChatsStrategy.MOVE_TO_FOLDER     \# переместить в отдельную папку (например, "Прочие")
UnmatchedChatsStrategy.LOG_ONLY           \# вывести только в лог
UnmatchedChatsStrategy.REMOVE_FROM_FOLDERS \# удалить из всех папок

```

---

## Логирование

Скрипт выводит подробные логи:

Пример вывода:
```

2025-10-18 17:48:42 - INFO - ✔ Connected to Telegram
2025-10-18 17:48:43 - INFO - ✚ Created folder "Работа" (ID=3)
2025-10-18 17:48:44 - INFO - ✎ Updated folder "Крипто"
2025-10-18 17:48:45 - INFO - − Removed chat(s) from "Dev" after adding to "Работа"

```

---

## Поддержка и безопасность

- Не храните `.env` и `.session` в системе контроля версий
- Добавьте их в `.gitignore`
- При необходимости используйте отдельный аккаунт Telegram для автоматизации

---

## Лицензия

MIT License